<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Multi Machine - Robot Rescue</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-1.10.2.min.js" defer></script>
    <script src="../js/bootstrap-3.3.7.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Robot Rescue</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../Setup/" class="nav-link">Setup</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Simultation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../URDF/" class="dropdown-item">Modèle</a>
</li>
                                    
<li>
    <a href="../TF/" class="dropdown-item">Transformations</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Gazebo</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Plugins/" class="dropdown-item">Plugins</a>
</li>
            
<li>
    <a href="../Sim/" class="dropdown-item">Simulation</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Navigation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Nav/" class="dropdown-item">Navigation</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Recovery</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Recovery_Plugin/" class="dropdown-item">Plugin Custum</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../Bt/" class="nav-link">Behavior Tree</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Multi Machine</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../Bt/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#communication-multimachine" class="nav-link">Communication Multimachine</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#1-utilisation-dune-machine-maitre" class="nav-link">1. Utilisation d'une machine "maître"</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2-utilisation-de-la-classe-c-rosmaster" class="nav-link">2. Utilisation de la classe c++ ros::master</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#3-utilisation-de-ros-bridge" class="nav-link">3. Utilisation de ROS Bridge</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="communication-multimachine">Communication Multimachine</h1>
<p>En robotique il est souvent nécessaire d'avoir plusieurs machines qui communiquent entre elles. Dans notre cas nous avons un robot mobile qui doit communiquer avec une console déportée</p>
<p>Il existe plusieurs façons de communiquer entre machines avec ROS</p>
<p>Nous allons décrire quelqu'une de ces méthodes en présentant leurs avantages et inconvénients</p>
<p>Dans toutes ces méthodes des machines partage le même réseau.
Pour que deux machines puissent communiquer correctement, il est important,
dans <mark>/etc/hosts</mark>,  d'ajouter la ligne suivante:</p>
<h4 id="au-niveau-de-la-machine1">Au niveau de la machine1</h4>
<div class="highlight"><pre><span></span><code>[IP machinne 1]    [Nom machinne 1]
</code></pre></div>
<p>exemple:</p>
<div class="highlight"><pre><span></span><code>192.168.1.4     robot
</code></pre></div>
<h4 id="au-niveau-de-la-machine2">Au niveau de la machine2</h4>
<div class="highlight"><pre><span></span><code>[IP machinne 2]    [Nom machinne 2]
</code></pre></div>
<p>exemple:</p>
<div class="highlight"><pre><span></span><code>192.168.1.5     console
</code></pre></div>
<h2 id="1-utilisation-dune-machine-maitre">1. Utilisation d'une machine "maître"</h2>
<p>La méthode la plus simple et d'utiliser un master unique partagé par plusieurs machines.</p>
<p><img alt="Image title" src="../images/RosMasterUnique.png" /></p>
<p>Nous avons une machine "maître" qui partage son master avec des machines "escalves".</p>
<h4 id="commande">Commande:</h4>
<p>Au niveau de la machine maître, dans un terminal:</p>
<div class="highlight"><pre><span></span><code>export ROS_HOSTNAME={IP MAITRE}
export ROS_MASTER_URI=http://{IP MAITRE}:11311
</code></pre></div>
<p>Au niveau de la machine esclave, dans un terminal:</p>
<div class="highlight"><pre><span></span><code>export ROS_HOSTNAME={IP ESCLAVE}
export ROS_MASTER_URI=http://{IP MAITRE}:11311
</code></pre></div>
<h4 id="exemple">Exemple:</h4>
<p>Prenons un exemple, nous avons deux machine, un robot et une console, d'adresse IP respective suivante :
192.168.1.1 et 192.168.1.2 </p>
<p><img alt="Image title" src="../images/RosMasterUnique2.png" /></p>
<p>Ici, on utilise le master de la console.</p>
<p>Au niveau de la console, dans un terminal:</p>
<div class="highlight"><pre><span></span><code>export ROS_HOSTNAME=192.168.1.1
export ROS_MASTER_URI=http://192.168.1.1:11311
</code></pre></div>
<p>Au niveau du robot, dans un terminal:</p>
<div class="highlight"><pre><span></span><code>export ROS_HOSTNAME=192.168.1.2
export ROS_MASTER_URI=http://192.168.1.1:11311
</code></pre></div>
<p>Ainsi les deux machines partage le même master et peuvent donc echanger des topics.</p>
<h3 id="avantage">Avantage</h3>
<p>Cette méthode et simple et rapide à mettre en place.</p>
<h3 id="inconveniants">Inconveniants</h3>
<p>Le problème est l'ulisation d'un master unique. En effet si une machine "esclave" pert la connection avec la machine "maître" alors elle pert le master et ne peut donc plus utiliser les nodes ROS. Dans notre cas si le robot s'eloigne de notre console est se deconnecte alors il ne pourra plus utiliser ROS.</p>
<h2 id="2-utilisation-de-la-classe-c-rosmaster">2. Utilisation de la classe c++ ros::master</h2>
<p>Cette méthode plus compliqué mais elle permet d'utiliser plusieurs master.
Pour cela une machine se connecte au master d'une machine "cible" souscrit a un topic et publie une copie de ce même topic dans son environement local (master local)</p>
<p>Il existe une methode de la classe ros,  <code>ros::master::init()</code>  qui peremt de se connecte à un autre master dans le même reseau.</p>
<p>Attention, pour utiliser cette méthode il important d'ajouter au niveau de chaque machine dans <code>/etc/hosts</code> les adresses IP des autres machines</p>
<h4 id="exemple-de-code">Exemple de code :</h4>
<p>dans le code suivant une console se connecte au master d'un robot, souscirt a son topic SCAN et publie une copie de ce topic dans son environnement local.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="c1">// On initialse notre node scan_copieur dans l&#39;environnement local</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">,</span><span class="s">&quot;scan_copieur&quot;</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">nh</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="c1">// on créer un objet de notre classe PublisherLocal, on appel ainsi le constructeur qui créé un publisher local</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="n">PublisherLocal</span><span class="w"> </span><span class="n">PublisherLocal</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="c1">//On declare les deux environemments</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">robot_master</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://192.168.1.4::11311&quot;</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">console_master</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://192.168.1.5::11311&quot;</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="c1">//On crée une varibale map M_string et on insere à l&#39;index __master le master auquel on veux se connecter</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">M_string</span><span class="w"> </span><span class="n">remappings</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="n">remappings</span><span class="p">[</span><span class="s">&quot;__master&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">robot_master</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">    </span><span class="c1">//On se connecte au master souhaité</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">master</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">remappings</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">    </span><span class="c1">//On souscrit au topic Scan, ici on souscrit dans l&#39;environnement du robot_master</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">    </span><span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="n">subscriberFeedback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;/scan&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PublisherLocal</span><span class="o">::</span><span class="n">callback</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hostTopic</span><span class="p">);</span><span class="w">  </span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">    </span><span class="p">[....]</span><span class="w"></span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="k">class</span><span class="w"> </span><span class="nc">PublisherLocal</span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="w">    </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">        </span><span class="n">PublisherLocal</span><span class="p">();</span><span class="w"></span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">        </span><span class="o">~</span><span class="n">PublisherLocal</span><span class="p">();</span><span class="w"></span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">LaserScan</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w">    </span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">        </span><span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span><span class="w"> </span><span class="n">pub</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="w">    </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="w">        </span><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="p">};</span><span class="w"></span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="n">PublisherLocal</span><span class="o">::</span><span class="n">PublisherLocal</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="w">    </span><span class="n">pub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">LaserScan</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;/scan&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="n">PublisherLocal</span><span class="o">::~</span><span class="n">PublisherLocal</span><span class="p">(){}</span><span class="w"></span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="kt">void</span><span class="w"> </span><span class="n">PublisherLocal</span><span class="o">::</span><span class="n">callback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">LaserScan</span><span class="w"> </span><span class="n">msg</span><span class="p">){</span><span class="w"> </span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ok</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="w">        </span><span class="n">oldSeq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">seq</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="w">        </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="w">    </span><span class="k">else</span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="w">        </span><span class="n">newSeq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">seq</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="w">        </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">newSeq</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">oldSeq</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="w">            </span><span class="n">pub</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Voir code complet -&gt; [lien git hub]</p>
<h3 id="avantage_1">Avantage</h3>
<p>Cette méthode permet d'avoir plus de contrôles sur la connexion entre machines, elle rend la communication plus flexible.
Chaque machine garde son propre master et peut donc être indépendante de la connexion réseau.</p>
<h3 id="inconveniants_1">Inconveniants</h3>
<p>La méthode est plus complexe et est unidirectionnelle, en effet dans l'exemple présenté précédemment, il s'agit d'une lecture et recopie mais pas d'un réel échange de topic.</p>
<p>Si plusieurs topics doivent être échangés, il devient fastidieux de réaliser une recopie pour chaque topic.</p>
<h2 id="3-utilisation-de-ros-bridge">3. Utilisation de ROS Bridge</h2>
<p>Dans l'exemple suivant nous allons utilisé ROS2. L'avantage de ROS2 est que la communication se fait sans Master. Nous allons utliser ROS 2 pour transferer les topic d'une machine ROS1 à une autre machine ROS1</p>
<p><img alt="Image title" src="../images/Ros1-2Bridge.png" /></p>
<h4 id="au-niveau-de-la-machine-1">Au niveau de la machine 1</h4>
<div class="highlight"><pre><span></span><code>export ROS_MASTER_URI=http://192.168.1.4:11311
export ROS_HOSTNAME=192.168.1.4
</code></pre></div>
<h4 id="au-niveau-de-la-machine-2">Au niveau de la machine 2</h4>
<p>Premier terminal</p>
<div class="highlight"><pre><span></span><code>export ROS_MASTER_URI=http://192.168.1.4:11311
source ROS1
source ROS2
ros2 run ros1_bridge dynamic_bridge --bridge-all-topics
</code></pre></div>
<p>Deuxième terminal</p>
<div class="highlight"><pre><span></span><code>source ROS1
source ROS2
ros2 run ros1_bridge dynamic_bridge --bridge-all-topics
</code></pre></div>
<p>Ce script .sh permet d'automatiser la connection</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">export</span> <span class="nv">ROS_MASTER_URI</span><span class="o">=</span>http://192.168.1.4:11311
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">source</span> <span class="si">${</span><span class="nv">ROS1</span><span class="si">}</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nb">source</span> <span class="si">${</span><span class="nv">ROS2</span><span class="si">}</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>gnome-terminal --tab --command<span class="o">=</span><span class="s2">&quot;ros2 run ros1_bridge dynamic_bridge --bridge-all-topics&quot;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="nb">export</span> <span class="nv">ROS_MASTER_URI</span><span class="o">=</span>http://localhost:11311
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="nb">source</span> <span class="si">${</span><span class="nv">ROS1</span><span class="si">}</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="nb">source</span> <span class="si">${</span><span class="nv">ROS2</span><span class="si">}</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>gnome-terminal --tab --command<span class="o">=</span><span class="s2">&quot;ros2 run ros1_bridge dynamic_bridge --bridge-all-topics&quot;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="nb">source</span> <span class="si">${</span><span class="nv">ROS1</span><span class="si">}</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="nb">source</span> devel/setup.bash
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>roslaunch nodes starting_launch.launch <span class="c1">#lancement d&#39;un node dans ROS1 local</span>
</code></pre></div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
